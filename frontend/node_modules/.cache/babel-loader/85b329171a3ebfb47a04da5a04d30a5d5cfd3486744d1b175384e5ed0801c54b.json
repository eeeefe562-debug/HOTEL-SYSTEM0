{"ast":null,"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  query,\n  transaction\n} = require('../config/database');\nconst {\n  authenticateToken\n} = require('../middleware/auth');\nconst {\n  body,\n  validationResult\n} = require('express-validator');\n\n// Aplicar autenticación a todas las rutas\nrouter.use(authenticateToken);\n\n// ============================================\n// LISTAR LISTA NEGRA\n// ============================================\nrouter.get('/', async (req, res) => {\n  try {\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\n    const blacklist = await query(`\n      SELECT b.*, u.full_name as reported_by_name\n      FROM blacklist b\n      LEFT JOIN users u ON b.reported_by = u.id\n      WHERE b.admin_id = ?\n      ORDER BY b.reported_at DESC\n    `, [adminId]);\n    res.json(blacklist);\n  } catch (error) {\n    console.error('Error al obtener lista negra:', error);\n    res.status(500).json({\n      error: 'Error al obtener lista negra'\n    });\n  }\n});\n\n// ============================================\n// AGREGAR A LISTA NEGRA\n// ============================================\nrouter.post('/', [body('full_name').notEmpty().withMessage('Nombre completo requerido'), body('document_number').notEmpty().withMessage('Número de documento requerido'), body('reason').notEmpty().withMessage('Razón requerida')], async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        errors: errors.array()\n      });\n    }\n    const {\n      full_name,\n      document_number,\n      reason,\n      additional_notes\n    } = req.body;\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\n    const reportedBy = req.user.id;\n\n    // Verificar si ya existe\n    const existing = await query('SELECT id FROM blacklist WHERE admin_id = ? AND document_number = ?', [adminId, document_number]);\n    if (existing && existing.length > 0) {\n      return res.status(400).json({\n        error: 'Esta persona ya está en la lista negra'\n      });\n    }\n    const result = await query(`INSERT INTO blacklist (admin_id, full_name, document_number, reason, additional_notes, reported_by)\n       VALUES (?, ?, ?, ?, ?, ?)`, [adminId, full_name, document_number, reason, additional_notes || null, reportedBy]);\n    res.status(201).json({\n      message: 'Persona agregada a lista negra exitosamente',\n      id: result.insertId\n    });\n  } catch (error) {\n    console.error('Error al agregar a lista negra:', error);\n    res.status(500).json({\n      error: 'Error al agregar a lista negra'\n    });\n  }\n});\n\n// ============================================\n// VERIFICAR SI ESTÁ EN LISTA NEGRA\n// ============================================\nrouter.get('/check/:document', async (req, res) => {\n  try {\n    const {\n      document\n    } = req.params;\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\n    const blacklisted = await query(`SELECT b.*, u.full_name as reported_by_name\n       FROM blacklist b\n       LEFT JOIN users u ON b.reported_by = u.id\n       WHERE b.admin_id = ? AND b.document_number = ?`, [adminId, document]);\n    if (blacklisted && blacklisted.length > 0) {\n      res.json({\n        blacklisted: true,\n        info: blacklisted[0]\n      });\n    } else {\n      res.json({\n        blacklisted: false\n      });\n    }\n  } catch (error) {\n    console.error('Error al verificar lista negra:', error);\n    res.status(500).json({\n      error: 'Error al verificar lista negra'\n    });\n  }\n});\n\n// ============================================\n// REMOVER DE LISTA NEGRA\n// ============================================\nrouter.delete('/:id', async (req, res) => {\n  try {\n    const {\n      id\n    } = req.params;\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\n    const result = await query('DELETE FROM blacklist WHERE id = ? AND admin_id = ?', [id, adminId]);\n    if (result.affectedRows === 0) {\n      return res.status(404).json({\n        error: 'Registro no encontrado'\n      });\n    }\n    res.json({\n      message: 'Persona removida de lista negra exitosamente'\n    });\n  } catch (error) {\n    console.error('Error al remover de lista negra:', error);\n    res.status(500).json({\n      error: 'Error al remover de lista negra'\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","query","transaction","authenticateToken","body","validationResult","use","get","req","res","adminId","user","role","id","admin_id","blacklist","json","error","console","status","post","notEmpty","withMessage","errors","isEmpty","array","full_name","document_number","reason","additional_notes","reportedBy","existing","length","result","message","insertId","document","params","blacklisted","info","delete","affectedRows","module","exports"],"sources":["C:/Users/WILLIAM/Desktop/hotel-system/frontend/src/components/cashier/GuestRegistrationForm.jsx"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { query, transaction } = require('../config/database');\r\nconst { authenticateToken } = require('../middleware/auth');\r\nconst { body, validationResult } = require('express-validator');\r\n\r\n// Aplicar autenticación a todas las rutas\r\nrouter.use(authenticateToken);\r\n\r\n// ============================================\r\n// LISTAR LISTA NEGRA\r\n// ============================================\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\r\n\r\n    const blacklist = await query(`\r\n      SELECT b.*, u.full_name as reported_by_name\r\n      FROM blacklist b\r\n      LEFT JOIN users u ON b.reported_by = u.id\r\n      WHERE b.admin_id = ?\r\n      ORDER BY b.reported_at DESC\r\n    `, [adminId]);\r\n\r\n    res.json(blacklist);\r\n  } catch (error) {\r\n    console.error('Error al obtener lista negra:', error);\r\n    res.status(500).json({ error: 'Error al obtener lista negra' });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// AGREGAR A LISTA NEGRA\r\n// ============================================\r\nrouter.post('/', [\r\n  body('full_name').notEmpty().withMessage('Nombre completo requerido'),\r\n  body('document_number').notEmpty().withMessage('Número de documento requerido'),\r\n  body('reason').notEmpty().withMessage('Razón requerida')\r\n], async (req, res) => {\r\n  try {\r\n    const errors = validationResult(req);\r\n    if (!errors.isEmpty()) {\r\n      return res.status(400).json({ errors: errors.array() });\r\n    }\r\n\r\n    const { full_name, document_number, reason, additional_notes } = req.body;\r\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\r\n    const reportedBy = req.user.id;\r\n\r\n    // Verificar si ya existe\r\n    const existing = await query(\r\n      'SELECT id FROM blacklist WHERE admin_id = ? AND document_number = ?',\r\n      [adminId, document_number]\r\n    );\r\n\r\n    if (existing && existing.length > 0) {\r\n      return res.status(400).json({ error: 'Esta persona ya está en la lista negra' });\r\n    }\r\n\r\n    const result = await query(\r\n      `INSERT INTO blacklist (admin_id, full_name, document_number, reason, additional_notes, reported_by)\r\n       VALUES (?, ?, ?, ?, ?, ?)`,\r\n      [adminId, full_name, document_number, reason, additional_notes || null, reportedBy]\r\n    );\r\n\r\n    res.status(201).json({\r\n      message: 'Persona agregada a lista negra exitosamente',\r\n      id: result.insertId\r\n    });\r\n  } catch (error) {\r\n    console.error('Error al agregar a lista negra:', error);\r\n    res.status(500).json({ error: 'Error al agregar a lista negra' });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// VERIFICAR SI ESTÁ EN LISTA NEGRA\r\n// ============================================\r\nrouter.get('/check/:document', async (req, res) => {\r\n  try {\r\n    const { document } = req.params;\r\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\r\n\r\n    const blacklisted = await query(\r\n      `SELECT b.*, u.full_name as reported_by_name\r\n       FROM blacklist b\r\n       LEFT JOIN users u ON b.reported_by = u.id\r\n       WHERE b.admin_id = ? AND b.document_number = ?`,\r\n      [adminId, document]\r\n    );\r\n\r\n    if (blacklisted && blacklisted.length > 0) {\r\n      res.json({\r\n        blacklisted: true,\r\n        info: blacklisted[0]\r\n      });\r\n    } else {\r\n      res.json({\r\n        blacklisted: false\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al verificar lista negra:', error);\r\n    res.status(500).json({ error: 'Error al verificar lista negra' });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// REMOVER DE LISTA NEGRA\r\n// ============================================\r\nrouter.delete('/:id', async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const adminId = req.user.role === 'admin' ? req.user.id : req.user.admin_id;\r\n\r\n    const result = await query(\r\n      'DELETE FROM blacklist WHERE id = ? AND admin_id = ?',\r\n      [id, adminId]\r\n    );\r\n\r\n    if (result.affectedRows === 0) {\r\n      return res.status(404).json({ error: 'Registro no encontrado' });\r\n    }\r\n\r\n    res.json({ message: 'Persona removida de lista negra exitosamente' });\r\n  } catch (error) {\r\n    console.error('Error al remover de lista negra:', error);\r\n    res.status(500).json({ error: 'Error al remover de lista negra' });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}